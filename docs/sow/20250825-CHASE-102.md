# SOW: CHASE-102: デザイントークンのプレビューページ、LLM用デザイントークンJSONの作成

## プロジェクト概要

**課題ID**: CHASE-102
**作成日**: 2025-08-25
**種別**: 機能追加

## 1. 背景と目的

### 背景

デザイントークンからTailwindのテーマ定義を作成するシステムが導入されたが、以下の課題が存在する：

- デザイントークンをメンテナンスする際に、変更内容を人間が目視確認できるプレビュー画面が不足
- LLM向けには、プロジェクトで利用可能なTailwindユーティリティクラスとその使用場面を整理した資料が不足
- デザイントークンとTailwindクラスの不整合を早期発見する仕組みが不足

### 目的

- Storybook上にデザインシステムプレビューセクションを構築し、デザイナー・開発者が直感的にトークンを確認できるようにする
- LLM向けにTailwindユーティリティクラスの使用指針をJSON形式で提供する
- デザイントークンとTailwindクラスの不整合を視覚的に検出可能にする

## 2. 実装スコープ

### 実装対象

- Storybookデザインシステムプレビューページの作成（7カテゴリ）
- デザイントークンコンバーターへのLLMドキュメント生成機能追加
- LLM向けTailwindユーティリティドキュメントJSONの自動生成

### カテゴリ別実装項目

1. **Colors (色)**
   - プリミティブカラーとセマンティックカラーの表示
   - カラーコード、Tailwindクラス名、用途の併記

2. **Typography (タイポグラフィ)**
   - フォントファミリー、サイズ、行高の表示
   - 見出しレベル別の実際のテキスト表示

3. **Spacing (スペーシング)**
   - マージン・パディング用のスペーシングスケール
   - 視覚的なゲージによる大きさ表現

4. **Sizing (サイジング)**
   - 幅・高さ用のサイズスケール
   - 長方形による大きさの視覚化

5. **Borders (ボーダー・角丸)**
   - ボーダー幅と角丸のバリエーション表示
   - 実際のボーダーサンプル表示

6. **Shadows (シャドウ・エフェクト)**
   - ドロップシャドウとバックドロップブラーの段階表示
   - カードサンプルによる効果の可視化

7. **Transitions (トランジション)**
   - デュレーション、イージング、プロパティグループの表示
   - インタラクティブなアニメーション例

### 実装除外項目

- デザイントークン自体の変更・追加
- 既存のデザイントークン変換スクリプトの改修
- 新しいTailwindクラスの追加

## 3. 技術仕様

### ディレクトリ構成

```
packages/frontend/
├── components/
│   └── design-systems/
│       ├── colors.stories.mdx
│       ├── typography.stories.mdx
│       ├── spacing.stories.mdx
│       ├── sizing.stories.mdx
│       ├── borders.stories.mdx
│       ├── shadows.stories.mdx
│       └── transitions.stories.mdx
├── scripts/
│   └── design-token-converter/
│       ├── llm-doc-generator.ts    # 新規作成
│       └── index.ts                # 更新（LLMドキュメント生成を統合）
└── docs/
    └── design/
        └── tailwind-utilities.json  # 自動生成
```

### Storybookコンポーネント仕様

#### 共通レイアウト設計

```mdx
import { Meta } from "@storybook/addon-docs/blocks";

<Meta title="Design System/Colors" />

# Colors

デザイントークンで定義されたカラーパレットです。

## Primitive Colors

### Gray Scale

<!-- Tailwindクラスを使用した色見本表示 -->

## Semantic Colors

### Primary Colors

<!-- 用途別の色分類表示 -->
```

#### 視覚化要件

- **色**: カラーパッチ + カラーコード + Tailwindクラス名 + 用途説明
- **スペーシング**: 段階的なバーチャート + ピクセル値 + Tailwindクラス名
- **タイポグラフィ**: 実際のテキストサンプル + フォント情報 + Tailwindクラス名
- **その他**: 対象要素の特性に応じた適切な視覚表現

### LLMドキュメントJSON仕様

```typescript
interface TailwindUtilitiesDoc {
  color: {
    primitive: {
      [tokenName: string]: {
        tailwindClass: string;
        usage: string;
        description: string;
      };
    };
    semantic: {
      [tokenName: string]: {
        tailwindClass: string;
        usage: string;
        description: string;
      };
    };
  };
  typography: {
    [tokenName: string]: {
      tailwindClass: string;
      usage: string;
      context: string;
    };
  };
  spacing: {
    /* 同様の構造 */
  };
  sizing: {
    /* 同様の構造 */
  };
  borders: {
    /* 同様の構造 */
  };
  shadows: {
    /* 同様の構造 */
  };
  transitions: {
    /* 同様の構造 */
  };
}
```

### Tailwindクラス使用の必須化

- 全てのスタイリングはTailwindユーティリティクラスを使用
- デザイントークンに対応するTailwindクラスが存在しない場合、スタイルが適用されず不整合を視覚的に検出可能
- インラインCSSの使用は禁止

### デザイントークンコンバーター拡張仕様

#### LLMドキュメント生成機能

既存のコンバーター（`packages/frontend/scripts/design-token-converter/`）を拡張し、Tailwind CSS生成と同時にLLM向けドキュメントを自動生成します。

```typescript
// llm-doc-generator.ts
export class LLMDocGenerator {
  generateUtilitiesDoc(parsedTokens: ParsedTokens): TailwindUtilitiesDoc;
  private generateColorDoc(colorTokens: ColorTokens): ColorUtilities;
  private generateTypographyDoc(typographyTokens: TypographyTokens): TypographyUtilities;
  // 他のカテゴリ用メソッド
}
```

#### 生成タイミング

- `pnpm generate:tailwind-theme` 実行時に自動実行
- `convert.ts` スクリプト内でTailwind CSS生成後にLLMドキュメント生成を実行
- ファイル出力先: `packages/frontend/docs/design/tailwind-utilities.json`

#### 利点

- デザイントークン更新時の自動同期
- 手動メンテナンス作業の排除
- トークンとドキュメントの整合性保証

## 4. 実装ファイル一覧

### 新規作成ファイル

1. **`packages/frontend/components/design-systems/colors.stories.mdx`**
   - プリミティブカラー（gray, blue, green, yellow, red）の表示
   - セマンティックカラー（primary, secondary, surface等）の表示

2. **`packages/frontend/components/design-systems/typography.stories.mdx`**
   - フォントファミリーの表示
   - スケール（xs-4xl）の表示
   - セマンティックタイポグラフィ（heading, body, caption）の表示

3. **`packages/frontend/components/design-systems/spacing.stories.mdx`**
   - スペーシングスケール（0-128）の視覚化
   - 固定値（px, 1/2, full）の表示

4. **`packages/frontend/components/design-systems/sizing.stories.mdx`**
   - サイズスケールの視覚化
   - レスポンシブサイズ（1/2, full等）の表示

5. **`packages/frontend/components/design-systems/borders.stories.mdx`**
   - ボーダー幅（1px-8px）の表示
   - ボーダー角丸（sm, default, full）の表示

6. **`packages/frontend/components/design-systems/shadows.stories.mdx`**
   - ドロップシャドウ（sm, default, lg）の表示
   - バックドロップブラー効果の表示

7. **`packages/frontend/components/design-systems/transitions.stories.mdx`**
   - トランジションデュレーションの表示
   - イージングカーブの視覚化

8. **`packages/frontend/scripts/design-token-converter/llm-doc-generator.ts`**
   - LLMドキュメント生成クラスの実装
   - カテゴリ別ドキュメント生成ロジック

### 更新対象ファイル

1. **`packages/frontend/scripts/design-token-converter/index.ts`**
   - LLMドキュメント生成機能の統合
   - `generateAll()` メソッドにLLMドキュメント生成を追加

2. **`packages/frontend/scripts/design-token-converter/convert.ts`**
   - LLMドキュメント生成の実行フロー追加

### 自動生成ファイル

1. **`packages/frontend/docs/design/tailwind-utilities.json`**
   - 全デザイントークンのTailwindクラスマッピング
   - LLM向け使用ガイドライン（自動生成）

## 5. テスト戦略

### 手動テスト

- Storybook起動確認
- 各カテゴリページの表示確認
- Tailwindクラスの適用確認
- レスポンシブ表示確認

### 整合性チェック

- デザイントークンとTailwindクラスの対応確認
- 不整合箇所のスタイル外れ確認
- JSONファイルの構文チェック

### Unit Test

- 今回は実装しない（Storybookの手動確認を優先）

## 6. 受け入れ基準

### 機能要件

- [ ] Storybook上で「Design System」セクションが表示される
- [ ] 7つのカテゴリページが正常に表示される
- [ ] 各デザイントークンの値、Tailwindクラス名、用途が正しく表示される
- [ ] スペーシング・サイジングが視覚的に理解しやすく表示される
- [ ] LLM向けJSONファイルが適切に構造化されている

### 非機能要件

- [ ] 既存のStorybookビルドが正常に動作する
- [ ] ページの読み込み速度が実用的である
- [ ] レスポンシブデザインに対応している

### 品質要件

- [ ] 全てのスタイリングがTailwindユーティリティクラスで記述されている
- [ ] デザイントークンの不整合が視覚的に検出可能である
- [ ] JSONファイルがValidな形式である

## 7. 実装手順

### Phase 1: 基盤構築

- 1-1. `components/design-systems/`ディレクトリ作成
- 1-2. 共通レイアウトパターンの検討
- 1-3. Storybookでのディレクトリ構成確認

### Phase 2: カラーシステム実装

- 2-1. `colors.stories.mdx`の実装
- 2-2. プリミティブカラーの表示
- 2-3. セマンティックカラーの表示
- 2-4. 表示確認とスタイル調整

### Phase 3: タイポグラフィシステム実装

- 3-1. `typography.stories.mdx`の実装
- 3-2. フォントファミリーとスケール表示
- 3-3. セマンティックタイポグラフィ表示

### Phase 4: スペーシング・サイジングシステム実装

- 4-1. `spacing.stories.mdx`の実装
- 4-2. `sizing.stories.mdx`の実装
- 4-3. 視覚的なゲージ・長方形による表現

### Phase 5: その他要素システム実装

- 5-1. `borders.stories.mdx`の実装
- 5-2. `shadows.stories.mdx`の実装
- 5-3. `transitions.stories.mdx`の実装

### Phase 6: LLMドキュメント生成機能実装

- 6-1. `llm-doc-generator.ts`の実装
- 6-2. 既存コンバーターへの統合（`index.ts`, `convert.ts`の更新）
- 6-3. 自動生成テストと動作確認

### Phase 7: 統合テスト・調整

- 7-1. 全体のStorybook表示確認
- 7-2. 不整合検出の動作確認
- 7-3. LLMドキュメント自動生成の統合テスト
- 7-4. ドキュメントの最終調整

## 8. リスク・考慮事項

### 技術的リスク

- **Tailwindクラスの網羅性**: 全てのデザイントークンに対応するTailwindクラスが存在しない可能性
- **Storybookビルドサイズ**: MDXファイル増加によるビルドサイズ肥大化
- **コンバーター複雑性**: 既存コンバーターへの機能追加による複雑化

### 軽減策

- デザイントークン変換スクリプトの確認により対応クラスを事前調査
- 必要最小限の表示に留めることでビルドサイズを抑制
- 段階的な機能追加により既存システムへの影響を最小化

### 運用上の考慮事項

- デザイントークン更新後は該当するStorybookページの確認を必須とする
- LLMドキュメントは自動生成のため手動メンテナンス不要
- 新しいデザイントークン追加時は対応するプレビューページの更新とLLMドキュメント生成ロジックの拡張を実施
