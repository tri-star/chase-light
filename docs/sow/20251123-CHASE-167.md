# SOW: CHASE-167: ベースコンポーネントの実装（ClButton / ClSpinner）

## プロジェクト概要

**課題ID**: CHASE-167  
**作成日**: 2025-11-23  
**種別**: 新機能開発（ベースUIコンポーネント追加）

## 1. 背景と目的

### 背景

- フロントエンド共通のベースUIにボタンとスピナーが未整備。各ページで都度実装するとデザイン／アクセシビリティが分散し、Tailwindトークンの適用漏れやフォーカススタイル不整合が発生しやすい。
- コンポーネントガイドラインで `ClSpinner` 利用を示唆しているが実体がないため、ローディング表現が統一できていない。
- ボタンのバリアント仕様（default/primary/secondary/outline）も未定義で、tailwind-variants によるクラス管理パターンが不足。

### 目的

- `components/base` に再利用可能な `ClButton` と `ClSpinner` を提供し、デザイン指針（Tailwindトークン、フォーカスリング、アクセシビリティ）に沿った統一的なUI部品を確立する。
- tailwind-variants を用いてボタンのバリアント／サイズを整理し、状態管理（hover/active/disabled/focus）を明文化する。
- スピナーをCSSアニメーションで実装し、ローディング状態の共通部品として利用可能にする。

## 2. 実装スコープ

### 実装対象

- 新規ベースコンポーネント: `ClButton`, `ClSpinner`
- 付随するストーリー（Storybook）とユニットテスト（Vitest）
- ドキュメント／コメントは最小限で実装意図を残す（コード内コメントは必要時のみ）

### 更新可能な項目

1. `packages/frontend/components/base/ClButton.vue`（新規）
2. `packages/frontend/components/base/ClSpinner.vue`（新規）
3. Storybook: `packages/frontend/components/base/ClButton.stories.ts`, `ClSpinner.stories.ts`（新規）
4. Unitテスト: `packages/frontend/components/base/__tests__/ClButton.test.ts`, `ClSpinner.test.ts`（新規）
5. 必要に応じて `components/base/layouts` 配下の関連スタイル定数を参照／追加検討（追加が不要な場合は触らない）

### 実装除外項目

- Backend/APIの追加・変更なし（openapi.json への影響なし）
- 既存ページ／機能への組み込みは今回は行わない（呼び出し側差し替えは別タスク）
- Design Token定義の変更は原則行わない（既存 `tailwind-utilities` で表現できない場合は別途提案）

## 3. 技術仕様

### API仕様

- 本タスクで新規APIは作成しない。BFF/Backendへの変更もなし。

### コンポーネント仕様

**ClButton**

- 配置: `packages/frontend/components/base/ClButton.vue`
- バリアント: `default`, `primary`, `secondary`, `outline`（tailwind-variants でクラス生成）
- 状態: 通常／hover／pressed／disabled／focus-visible。トークン例: `bg-surface-primary-default`, `bg-surface-primary-hovered`, `bg-surface-primary-pressed`, `bg-surface-primary-disabled`, `focus-visible:ring-status-focus-default`
- サイズ: `sm` / `md` / `lg`（高さ・パディング・フォントサイズをスケール）
- 形態: `block`（full width）オプションを提供予定
- アクセシビリティ: `<button type>` 明示、`disabled` 時は aria-disabled、フォーカスリング標準化
- 拡張: アイコン挿入用の `prefix` / `suffix` スロット、`loading` 時は `ClSpinner` をインラインで表示しクリック抑止（予定）

**ClSpinner**

- 配置: `packages/frontend/components/base/ClSpinner.vue`
- 表現: CSSアニメーションによる円形スピナー（`animate-spin` または keyframes）。非依存のSVG/CSSで軽量実装。
- サイズ: `xs` / `sm` / `md` / `lg` を想定（直径とボーダー幅をスケール）
- カラー: デフォルトは `border-surface-primary-default` + `border-t-transparent` のリング。`variant` で `primary` / `secondary` / `muted` 等を切替できる設計を検討。
- アクセシビリティ: `role="status"` + `aria-label` または `sr-only` テキストを付与、装飾用には `aria-hidden` 指定。

### データベース操作

- なし。

### アーキテクチャ設計

- Baseコンポーネント: `components/base` 配下、`Cl` プレフィックス遵守。
- クラス設計: tailwind-variants による構造化。状態の組合せ（variant × size × loading/disabled）をクラスマップとして定義し、透過的に `class`/`style` のマージを許容。
- ローディング連携: `ClButton` 内で `ClSpinner` をインライン利用（クライアント/SSR双方で動作）。
- Storybook: 代表的なバリアント・サイズ・disabled/loading 状態を args で切替可能にする。
- テスト: Vitest + @vue/test-utils によるDOM/emit検証。スピナーの回転は `animate-spin` 等のクラス付与を検証（タイミングのモック不要）。

## 4. 実装ファイル一覧

### 新規作成ファイル

1. `packages/frontend/components/base/ClButton.vue`
   - tailwind-variants でバリアント/サイズ/状態クラスを定義
   - prefix/suffixスロット、loading表示、button type/disabled制御
2. `packages/frontend/components/base/ClSpinner.vue`
   - 円形スピナーのテンプレートとアニメーション定義
3. `packages/frontend/components/base/ClButton.stories.ts`
   - バリアント・サイズ・loading・disabledの代表ケース
4. `packages/frontend/components/base/ClSpinner.stories.ts`
   - サイズ・カラーバリアントの表示例
5. `packages/frontend/components/base/__tests__/ClButton.test.ts`
   - バリアント/サイズクラスの付与、disabled時の非発火、loading時のスピナー表示を検証

### 更新対象ファイル

- 既存ファイルの更新は原則なし。共通定数やStorybook設定が必要になった場合のみ最小限で追記。

## 5. テスト戦略

### Component Test（Base UI）

- ClButton
  - バリアントごとに期待クラスが適用されること（default/primary/secondary/outline）
  - サイズごとに高さ・パディングが変化すること
  - disabled 時に `click` が発火しないこと
  - loading 時にスピナーが表示され、クリック抑止されること

### Unit Test（ロジック）

- 今回はロジックが単純なため追加ユニットテストは不要（コンポーネントテストに集約）。

### E2E / Storybook

- 既存E2Eへの追加は不要。Storybookはビジュアル確認用に代表ケースを用意。

## 6. 受け入れ基準

### 機能要件

- [ ] `ClButton` が default/primary/secondary/outline の4バリアントを提供し、Tailwindトークン準拠のスタイルが適用される
- [ ] `ClButton` が `sm/md/lg`（想定）サイズを提供し、disabled/loading/focus 状態に応じたスタイルと挙動を持つ
- [ ] `ClSpinner` が CSSアニメーションで円形に回転し、サイズ/variant 切替が可能
- [ ] Storybook で各バリアントが切り替え可能で表示崩れがない

### 非機能要件

- [ ] 既存のテストが全て通る
- [ ] 新規コンポーネントのテストが追加され、CIで実行可能
- [ ] アクセシビリティ属性（role/aria）が適切に設定されている

### セキュリティ要件

- [ ] 機密情報・外部通信は増やさない（UIのみの変更）

## 7. 実装手順

### Phase 1: コンポーネント設計・下準備

- 1-1. tailwind-variants で利用するトークンを確認（surface/interactive/focus系）
- 1-2. ClButton の props/slots/emit 仕様を固め、クラスマップを設計
- 1-3. ClSpinner のサイズ・カラー仕様を決定

### Phase 2: コンポーネント実装

- 2-1. `ClSpinner.vue` を実装（サイズ/variant/aria、CSSアニメーション）
- 2-2. `ClButton.vue` を実装（バリアント/サイズ/disabled/loading/focus、prefix/suffixスロット、type/emit）

### Phase 3: ストーリーとテスト

- 3-1. Storybook を作成し、代表的なバリアント・状態をカバー
- 3-2. Vitest によるコンポーネントテストを追加(ClButtonのみ)
- 3-3. `pnpm --filter frontend test`（必要に応じて部分実行）で確認

## 9. リスク・考慮事項

### 技術的リスク

- トークン選定ミスによるデザイン崩れ（primary/secondary/outline の色味が意図とずれる可能性）
- loading/disabled の組み合わせ時のフォーカス管理抜け
- Storybook/テストで tailwind-variants のクラス生成が期待とずれた場合のデバッグコスト

### 軽減策

- 既存コンポーネント（ClFabButton, ClToast）のクラス使用例を参照しトークン整合性を確認
- アクセシビリティ: role/ariaとfocus-visibleを明示し、テストで回帰防止
- Storybookでバリアント確認し、スナップショット（必要ならVRT）で差分検知を検討
