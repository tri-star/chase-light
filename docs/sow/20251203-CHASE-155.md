# SOW: CHASE-155: データソース一覧画面

## プロジェクト概要

**課題ID**: CHASE-155
**作成日**: 2025-12-03
**種別**: 新機能開発

## 1. 背景と目的

### 背景

現在、ユーザーがウォッチしているデータソース（GitHubリポジトリ）の一覧を確認する専用画面が存在しない。ダッシュボードからデータソースを追加する機能はあるが、登録済みのデータソースを一覧で確認・管理するUIが必要。

### 目的

- ユーザーがウォッチ中のデータソースを一覧で確認できる画面を提供する
- フリーワード検索やソート機能により目的のデータソースを素早く見つけられるようにする
- 無限スクロールによりスムーズなUXを実現する

## 2. 実装スコープ

### 実装対象

1. `/data-sources` ページの新規作成
2. サイドメニューに「データソース一覧」リンクを追加
3. Nuxt.js APIルート（BFF層）の確認（既存の `GET /api/data-sources` を利用）
4. データソース一覧表示コンポーネント群の作成
5. フリーワード検索機能
6. ソート機能（ドロップダウンによるソート順指定）
7. 無限スクロールによるページネーション

### 更新可能な項目

1. ソート順：name, createdAt, updatedAt, addedAt, starsCount（APIが対応）
2. ソート方向：asc, desc
3. フリーワード検索：name, description, url, fullName 対象

### 実装除外項目

- データソースの編集・削除機能（別課題として対応予定）
- データソースの新規登録機能（ダッシュボードから行う既存機能を利用）
- 高度なフィルタリング（言語、日付範囲など）は初期リリースでは対象外

## 3. 技術仕様

### API仕様

#### エンドポイント

```
GET /api/data-sources
```

#### 認証・認可

- JWT認証必須
- ユーザー自身がウォッチしているデータソースのみ返却

#### リクエストパラメータ（クエリ）

```typescript
{
  search?: string        // フリーワード検索
  sortBy?: 'name' | 'createdAt' | 'updatedAt' | 'addedAt' | 'starsCount'  // デフォルト: 'updatedAt'
  sortOrder?: 'asc' | 'desc'  // デフォルト: 'desc'
  page?: number          // ページ番号（1ベース）
  perPage?: number       // 1ページあたりの件数（デフォルト: 20）
}
```

#### レスポンス仕様

```typescript
{
  success: true,
  data: {
    items: DataSourceListItem[],  // dataSource + userWatch の配列
    pagination: {
      page: number,
      perPage: number,
      total: number,
      totalPages: number,
      hasNext: boolean,
      hasPrev: boolean
    }
  }
}
```

### データベース操作

- 今回の実装ではDBアクセスは不要（Backend API経由で取得）

### アーキテクチャ設計

既存のアクティビティ一覧画面と同様のレイヤード構成を採用：

- **Domain層**: `features/data-sources/domain/` にフロントエンド用型を定義
- **Repository層**: `features/data-sources/repositories/` にDataSourceListRepositoryを新規作成
- **Presentation層**:
  - ページエントリ: `pages/data-sources/index.vue`
  - ページ本体: `components/pages/data-sources/DataSourceListPage.vue`
  - パーツ: `components/pages/data-sources/parts/`

### UI設計

アクティビティ一覧（`/activities`）と同様の雰囲気で実装：

1. **ページヘッダー**: タイトル「データソース一覧」
2. **検索・ソートエリア**:
   - フリーワード入力フィールド
   - ソート順ドロップダウン
3. **一覧エリア**:
   - 各行は `ClDivider` で区切る
   - 表示項目: データソース名、description、スター数、ウォッチ状況（Release/PR/Issue）
4. **無限スクロール**: 既存の `useInfiniteScroll` composable を利用

## 4. 実装ファイル一覧

### 新規作成ファイル

1. **`packages/frontend/pages/data-sources/index.vue`**
   - ルーティングエントリ、ページメタ設定、ページ本体コンポーネントのマウント

2. **`packages/frontend/components/pages/data-sources/DataSourceListPage.vue`**
   - ページ本体のUIコンポーネント

3. **`packages/frontend/components/pages/data-sources/parts/DataSourceList.vue`**
   - 一覧表示コンポーネント（無限スクロール、検索、ソート機能を含む）

4. **`packages/frontend/components/pages/data-sources/parts/DataSourceListItem.vue`**
   - 個別データソースの表示コンポーネント

5. **`packages/frontend/components/pages/data-sources/parts/DataSourceItemSkeleton.vue`**
   - ローディング時のスケルトンコンポーネント

6. **`packages/frontend/features/data-sources/domain/data-source.ts`**
   - フロントエンド用のDataSource型定義

7. **`packages/frontend/features/data-sources/repositories/data-source-list-repository.ts`**
   - データソース一覧取得用のRepositoryクラス

### 更新対象ファイル

1. **`packages/frontend/components/base/layouts/default/ClSidebar.vue`**
   - ナビゲーションに「データソース一覧」リンクを追加

### 参照対象（既存利用）

1. **`packages/frontend/server/api/data-sources/index.get.ts`**
   - 既存のBFF層APIルート（修正不要）

2. **`packages/frontend/composables/use-infinite-scroll.ts`**
   - 無限スクロール用composable（そのまま利用）

3. **`packages/frontend/components/base/ClDivider.vue`**
   - 行区切り用コンポーネント（そのまま利用）

4. **`packages/frontend/components/base/ClDropdownMenu.vue`**
   - ソート順選択用ドロップダウン（そのまま利用）

## 5. テスト戦略

### Unit Test

- **`features/data-sources/repositories/data-source-list-repository.ts`**
  - Repository層のHTTPリクエスト処理とエラーハンドリング

### Component / Feature Test（ページテスト）

- **`components/pages/data-sources/__tests__/DataSourceListPage.test.ts`**
  - 一覧の初期表示
  - フリーワード検索によるフィルタリング
  - ソート順の変更
  - 無限スクロールによる追加読み込み
  - エラー時の表示
  - 空リスト時の表示

### E2Eテスト

- 今回は対象外（フィーチャーテストでカバー）

## 6. 受け入れ基準

### 機能要件

- [ ] `/data-sources` にアクセスするとデータソース一覧が表示される
- [ ] サイドメニューに「データソース一覧」のリンクが追加されている
- [ ] 各データソースで以下の情報が表示される
  - [ ] データソース名
  - [ ] description
  - [ ] スター数
  - [ ] ウォッチ状況（Release/PR/Issue のON/OFF）
- [ ] フリーワード検索でデータソースを絞り込める
- [ ] ドロップダウンでソート順を変更できる（更新日時、名前、スター数など）
- [ ] スクロールすると追加のデータソースが読み込まれる（無限スクロール）
- [ ] データソースが0件の場合、適切なメッセージが表示される

### 非機能要件

- [ ] 既存のテストが全て通る
- [ ] UIはアクティビティ一覧と同様の雰囲気で統一されている
- [ ] 各行は `ClDivider` で区切られている
- [ ] レスポンシブデザインに対応している（モバイル/デスクトップ）

### セキュリティ要件

- [ ] 認証が必要なページとして実装されている（`middleware: 'auth'`）
- [ ] 自分がウォッチしているデータソースのみが表示される

## 7. 実装手順

### Phase 1: Domain層・Repository層実装

- 1-1. `features/data-sources/domain/data-source.ts` の作成
- 1-2. `features/data-sources/repositories/data-source-list-repository.ts` の作成
- 1-3. format, lint, テスト実行, コミット

### Phase 2: ページコンポーネント実装

- 2-1. `components/pages/data-sources/parts/DataSourceItemSkeleton.vue` の作成
- 2-2. `components/pages/data-sources/parts/DataSourceListItem.vue` の作成
- 2-3. `components/pages/data-sources/parts/DataSourceList.vue` の作成（無限スクロール、検索、ソート含む）
- 2-4. `components/pages/data-sources/DataSourceListPage.vue` の作成
- 2-5. format, lint, コミット

### Phase 3: ページエントリ・ナビゲーション実装

- 3-1. `pages/data-sources/index.vue` の作成
- 3-2. `ClSidebar.vue` にナビゲーションリンク追加
- 3-3. format, lint, コミット

### Phase 4: テスト実装

- 4-1. Repository層のユニットテスト作成
- 4-2. ページのフィーチャーテスト作成
- 4-3. 全テスト実行・確認
- 4-4. format, lint, コミット

## 8. リスク・考慮事項

### 技術的リスク

- **無限スクロールの挙動**: 既存の `useInfiniteScroll` を流用するため、実績があり低リスク
- **検索・ソートのUX**: 検索入力のデバウンス処理が必要（入力のたびにAPI呼び出しを避ける）

### 軽減策

- 検索入力にはデバウンス（300ms程度）を適用
- 既存のアクティビティ一覧の実装パターンを踏襲し、一貫性を確保
- 段階的実装による品質確保

### 将来の拡張性

- データソース詳細画面へのリンク（一覧アイテムクリック時）は別課題で対応
- データソースの編集・削除機能は別課題で対応
