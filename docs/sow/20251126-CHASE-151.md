# SOW: CHASE-151: font-*のユーティリティクラス作成

## プロジェクト概要

**課題ID**: CHASE-151
**作成日**: 2025-11-26
**種別**: 機能追加

## 1. 背景と目的

### 背景

現在、デザイントークン（`design-tokens.json`）にはフォントに関する定義（`typography.scale.*`、`typography.semantic.*`）が存在し、デザイントークン変換スクリプトにより`--typography-scale-*`や`--typography-semantic-*`といったCSS変数が生成されています。

しかし、これらのCSS変数をTailwindユーティリティクラスとして使用するための`@utility`ディレクティブが生成されていないため、実際にはフォント関連のユーティリティクラスを利用することができません。

### 目的

`font-scale-*`や`font-semantic-*`のようなTailwindユーティリティクラスを使用可能にすることで、デザイントークンで定義されたフォント設定（フォントファミリー、サイズ、ウェイト、行間）を一括で適用できるようにします。

## 2. 実装スコープ

### 実装対象

1. Tailwind CSS生成スクリプトの修正
   - `@utility`ディレクティブの生成機能追加
2. 生成されたユーティリティクラスの動作確認

### 実装除外項目

- デザイントークン自体の変更（既に定義済み）
- LLMドキュメント（`tailwind-utilities.json`）の修正（既に正しいクラス名が記載されている）

## 3. 技術仕様

### デザイントークンの構造

#### typography.scale

```json
{
  "typography": {
    "scale": {
      "xs": {
        "value": {
          "fontFamily": "{typography.font-family.sans}",
          "fontSize": "0.75rem",
          "fontWeight": "400",
          "lineHeight": "1.5"
        }
      },
      // ... 他のスケール (sm, base, lg, xl, 2xl, 3xl, 4xl)
    }
  }
}
```

#### typography.semantic

```json
{
  "typography": {
    "semantic": {
      "heading-1": { "value": "{typography.scale.4xl}" },
      "heading-2": { "value": "{typography.scale.3xl}" },
      "heading-3": { "value": "{typography.scale.2xl}" },
      "heading-4": { "value": "{typography.scale.xl}" },
      "body": { "value": "{typography.scale.base}" },
      "body-sm": { "value": "{typography.scale.sm}" },
      "caption": { "value": "{typography.scale.xs}" },
      "code": {
        "value": {
          "fontFamily": "{typography.font-family.mono}",
          "fontSize": "0.875rem",
          "fontWeight": "400",
          "lineHeight": "1.6"
        }
      }
    }
  }
}
```

### 生成されるCSS変数（現状）

現在、以下のCSS変数が生成されています：

```css
--typography-scale-xs: 400 0.75rem/1.5 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Noto Sans CJK JP', 'Noto Sans JP', 'Yu Gothic', 'YuGothic', 'Meiryo', sans-serif;
--typography-scale-sm: 400 0.875rem/1.5 'Hiragino Sans', ...;
/* ... 他のスケール ... */

--typography-semantic-heading-1: 700 2.25rem/1.2 'Hiragino Sans', ...;
--typography-semantic-heading-2: 700 1.875rem/1.3 'Hiragino Sans', ...;
/* ... 他のセマンティック ... */
```

### 生成する@utilityディレクティブ（実装後）

以下の`@utility`ディレクティブを生成します：

```css
@utility font-scale-* {
  font: var(--typography-scale-*);
}

@utility font-semantic-* {
  font: var(--typography-semantic-*);
}
```

これにより、以下のようなクラスが使用可能になります：

- `font-scale-xs`, `font-scale-sm`, `font-scale-base`, `font-scale-lg`, `font-scale-xl`, `font-scale-2xl`, `font-scale-3xl`, `font-scale-4xl`
- `font-semantic-heading-1`, `font-semantic-heading-2`, `font-semantic-heading-3`, `font-semantic-heading-4`, `font-semantic-body`, `font-semantic-body-sm`, `font-semantic-caption`, `font-semantic-code`

### アーキテクチャ設計

変換スクリプトの構成（既存）：

```
packages/frontend/scripts/design-token-converter/
├── index.ts                    # メインエントリーポイント
├── token-parser.ts            # デザイントークンのパース処理
├── tailwind-generator.ts      # Tailwind CSS生成（修正対象）
├── llm-doc-generator.ts       # LLMドキュメント生成
└── types.ts                   # 型定義
```

修正対象：`tailwind-generator.ts`の`generateThemedTailwindCSS()`メソッド

## 4. 実装ファイル一覧

### 更新対象ファイル

1. **`packages/frontend/scripts/design-token-converter/tailwind-generator.ts`**
   - `generateTypographyUtilities()`メソッドの追加
   - `generateThemedTailwindCSS()`メソッドの修正（@utilityセクションの追加）

2. **`packages/frontend/scripts/design-token-converter/__tests__/tailwind-generator.test.ts`**
   - 既存テストの更新（スナップショット等）

### 生成物

1. **`packages/frontend/assets/css/tailwind.css`**
   - `@utility`ディレクティブが追加される

## 5. テスト戦略

### Unit Test（tailwind-generator.test.ts）

- `generateThemedTailwindCSS()`の出力に`@utility`ディレクティブが含まれることを確認
- 生成されたCSS文字列が期待通りのフォーマットであることを確認

### 手動動作確認

1. スクリプト実行: `pnpm --filter frontend generate:tailwind-theme`
2. 生成されたtailwind.cssに以下が含まれることを確認：
   - `@utility font-scale-*`
   - `@utility font-semantic-*`
3. 簡単なサンプルHTML/Vueコンポーネントで実際にクラスが適用されることを確認

## 6. 受け入れ基準

### 機能要件

- [ ] `pnpm --filter frontend generate:tailwind-theme`実行後、tailwind.cssに`@utility font-scale-*`ディレクティブが含まれる
- [ ] `pnpm --filter frontend generate:tailwind-theme`実行後、tailwind.cssに`@utility font-semantic-*`ディレクティブが含まれる
- [ ] 生成されたユーティリティクラスが実際に使用可能（ビルドエラーなし）

### 非機能要件

- [ ] 既存のテストが全て通る
- [ ] LLMドキュメント（`tailwind-utilities.json`）に不要な変更がない
- [ ] 他のユーティリティクラス（color, spacingなど）の生成に影響がない

## 7. 実装手順

### Phase 1: TailwindGeneratorの実装

- 1-1. `generateTypographyUtilities()`メソッドを追加
  - scaleとsemanticの両方の`@utility`ディレクティブを生成
- 1-2. `generateThemedTailwindCSS()`メソッドを修正
  - 生成したutilityディレクティブをCSS出力に追加
- 1-3. 既存テストを更新（スナップショット等）
- 1-4. format, lint, test実行
- 1-5. コミット

### Phase 2: 動作確認と検証

- 2-1. `pnpm --filter frontend generate:tailwind-theme`を実行
- 2-2. 生成されたtailwind.cssの内容を確認
  - `@utility`ディレクティブが含まれているか
  - CSS変数の参照が正しいか
- 2-3. 簡単なサンプルコンポーネントでクラスの動作を確認
  - `font-scale-base`を適用したテキストが正しくスタイリングされるか
  - `font-semantic-heading-1`を適用したテキストが正しくスタイリングされるか
- 2-4. 問題があれば修正、再確認
- 2-5. format, lint, test実行
- 2-6. コミット

### Phase 3: PRの作成

- 3-1. PRを作成
- 3-2. PlaneのCHASE-151課題を更新
  - 関連PRとして今回のPRを追記
  - 作業内容を反映

## 8. リスク・考慮事項

### 技術的リスク

- **Tailwind v4の@utilityディレクティブ**: Tailwind v4の`@utility`ディレクティブの正しい記法を確認する必要がある
- **CSS変数のフォーマット**: `font`ショートハンドプロパティに適したフォーマットであることを確認
- **既存スタイルへの影響**: 新しいユーティリティクラスが既存のスタイルに影響を与えないことを確認

### 軽減策

- 公式ドキュメントでTailwind v4の`@utility`記法を確認
- 既存テストの実行で回帰を検知
- 段階的な実装とレビューによる品質確保

### 参考資料

- [Tailwind CSS v4 - Custom Utilities](https://tailwindcss.com/docs/v4/custom-utilities)
- CSS font shorthand property: `font: [font-weight] [font-size]/[line-height] [font-family]`
