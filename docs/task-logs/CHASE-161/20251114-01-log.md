# CHASE-161 作業ログ

## 作業日: 2025-11-14

## 目的
ClFabButtonにFABの配置責務とz-indexトークンを追加し、DataSourceFabButton.vueを削除してダッシュボードから直接ClFabButtonを使用できるようにする。

## 実装計画

### Phase 1: デザイントークンとスクリプト修正
- [ ] 1-1. `scripts/design-token-converter/types.ts`に`zIndex?: TokenGroup`を追加
- [ ] 1-2. `scripts/design-token-converter/llm-doc-generator.ts`を修正
  - [ ] `TailwindUtilitiesDoc`型に`zIndex`プロパティを追加
  - [ ] `generateZIndex`メソッドを追加
  - [ ] `generateUtilitiesDoc`メソッドの戻り値に`zIndex`を含める
- [ ] 1-3. `design-tokens.json`にzIndexトークンを追加
- [ ] 1-4. `pnpm --filter frontend generate:tailwind-theme`を実行
- [ ] 1-5. `tailwind-utilities.json`を確認
- [ ] 1-6. `assets/css/tailwind.css`を確認
- [ ] 1-7. format, lint実行
- [ ] 1-8. コミット

### Phase 2: ClFabButton実装
- [ ] 2-1. ClFabButton.vueにposition, offsetX, offsetYのprops定義を追加
- [ ] 2-2. 固定配置用のクラス計算ロジックを追加
- [ ] 2-3. z-fabクラスを適用
- [ ] 2-4. レスポンシブオフセットの実装
- [ ] 2-5. ユニットテストの更新
- [ ] 2-6. format, lint, test実行
- [ ] 2-7. コミット

### Phase 3: Storybook更新
- [ ] 3-1. ClFabButton.stories.tsに配置位置バリエーションのストーリー追加
- [ ] 3-2. オフセット調整のストーリー追加
- [ ] 3-3. Storybookで表示確認
- [ ] 3-4. format, lint実行
- [ ] 3-5. コミット

### Phase 4: DashboardPage.vueの更新とDataSourceFabButton.vueの削除
- [ ] 4-1. DashboardPage.vueを更新
- [ ] 4-2. DataSourceFabButton.vueを削除
- [ ] 4-3. 開発サーバーで動作確認
- [ ] 4-4. format, lint実行
- [ ] 4-5. コミット

### Phase 5: 最終確認
- [ ] 5-1. 全テスト実行
- [ ] 5-2. Storybook確認
- [ ] 5-3. 開発サーバー確認
- [ ] 5-4. PR作成準備

## 作業記録

### Phase 1: デザイントークンとスクリプト修正 ✅

#### 完了した作業

1. **types.ts修正**
   - `DesignTokens`インターフェースに`zIndex?: TokenGroup`を追加

2. **llm-doc-generator.ts修正**
   - `TailwindUtilitiesDoc`型に`zIndex`プロパティを追加
   - `generateZIndex`メソッドを追加（spacingやradiusと同様のパターン）
   - `generateUtilitiesDoc`メソッドの戻り値に`zIndex`を含めた

3. **design-tokens.json修正**
   - zIndexトークンを追加（fab: 1050）

4. **テーマ生成**
   - `pnpm generate:tailwind-theme`を実行して成功

5. **生成物確認**
   - `tailwind-utilities.json`に`zIndex`セクションが追加され、`values: ["fab"]`が含まれることを確認
   - `assets/css/tailwind.css`に`--zIndex-fab: 1050;`が追加されることを確認

6. **format, lint実行**
   - 全てエラーなしで完了

7. **コミット**
   - Phase 1の変更をコミット（c4bab80）

### Phase 2: ClFabButton実装 ✅

#### 完了した作業

1. **ClFabButton.vue修正**
   - `Position` 型を追加（'bottom-right' | 'bottom-left' | 'top-right' | 'top-left'）
   - `position`, `offsetX`, `offsetY` のpropsを追加
   - `positionClasses` computed propertyを実装し、固定配置とレスポンシブオフセットを実現
   - `z-fab`クラスを適用

2. **ClFabButton.test.ts更新**
   - `it`を`test`に変更（プロジェクトガイドラインに従う）
   - デフォルトでbottom-right配置となることを確認するテストを追加
   - z-fabクラスが適用されることを確認するテストを追加
   - 4つの配置位置すべてに対するパラメトライズドテストを追加

3. **format, lint, test実行**
   - 全175テストがパス
   - format, lintエラーなし

4. **コミット**
   - Phase 2の変更をコミット

### Phase 3: Storybook更新 ✅

#### 完了した作業

1. **ClFabButton.stories.ts更新**
   - `argTypes`に`position`, `offsetX`, `offsetY`を追加
   - `BottomLeft`, `TopRight`, `TopLeft`ストーリーを追加
   - `CustomOffset`ストーリーを追加（オフセット調整の例）

2. **format, lint実行**
   - エラーなしで完了

3. **コミット**
   - Phase 3の変更をコミット

### Phase 4: DashboardPage.vueの更新とDataSourceFabButton.vueの削除 ✅

#### 完了した作業

1. **DashboardPage.vue更新**
   - importを`DataSourceFabButton`から`ClFabButton`に変更
   - テンプレートで`ClFabButton`を直接使用
   - `data-testid="fab-button"`と`icon="mdi:plus"`を追加

2. **DataSourceFabButton.vue削除**
   - 不要になった中間コンポーネントを削除

3. **format, lint, test実行**
   - 全175テストがパス
   - format, lintエラーなし

4. **コミット準備**
   - 次はコミットを作成

#### 次のステップ

Phase 4の変更をコミットし、Phase 5（最終確認）に進みます。
