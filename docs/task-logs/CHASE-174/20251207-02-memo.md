# CHASE-174 引き継ぎメモ (2025-12-07 セッション終了時点)

## 状況サマリ

- 本文翻訳ステータスのDB/ドメイン/リポジトリ/ユースケース/ワーカー/プレゼンまで実装済み。
- プレゼンルート: `/activities/{id}/translation/body` (POST) + `/activities/{id}/translation/body/status` (GET) を追加。レスポンスに本文翻訳ステータス/タイムスタンプ/エラーを含める。
- ワーカー: `translate-activity-body` 追加。pending→processing→completed/failed を実装。
- テスト: 翻訳ワーカーのコンポーネントテストを追加。プレゼン系既存テストは翻訳ユースケースをモック注入して通過。
- 最新コミット: `test(CHASE-174): 本文翻訳API/ワーカーのテスト追加` (直前)、その前に `feat(CHASE-174): 本文翻訳APIのプレゼン層追加` / `feat(CHASE-174): 本文翻訳処理のユースケースとワーカー追加` / `feat(CHASE-174): 本文翻訳ステータスの基盤整備`。

## 残課題 / 次にやると良いこと

1. OpenAPI更新: 新ルートを反映するため `pnpm --filter backend openapi:update` 実行（未実行）。
2. Presentationレスポンスのsource情報: 現在、翻訳ルートでの `toActivityDetail` が source をプレースホルダーで埋めている。Query経由の情報に合わせるか、適切な source 情報を付与する要否を確認。
3. コンポーネントテスト追加: 翻訳ルートのAPIコンポーネントテスト（POST/GETのアクセストークン/404/409/force）を追加すると受け入れ基準に近づく。
4. インフラ整備: 翻訳ジョブのpending取得/キュー投入部分はまだ実運用フローと繋がっていない（SOW Phase3で要確認）。

## 実行済みコマンド

- `pnpm format`
- `pnpm lint`
- `pnpm test`

## メモ

- 翻訳ポートはactivities配下に新設（OpenAI + Stub + Null）。ファクトリで `USE_EXTERNAL_AI_API_STUB` を見る。
- DrizzleActivityRepository(activities) が本文翻訳専用の状態更新/ロック/ペンディング取得を提供。
- ワーカーコンポーネントテストはStub翻訳で成功/失敗/skipをカバー。環境変数 `USE_EXTERNAL_AI_API_STUB=true` 必須。
