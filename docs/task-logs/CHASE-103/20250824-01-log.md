# CHASE-103: ダークモード対応 - 実装ログ

## 基本情報

- **課題ID**: CHASE-103
- **作業日**: 2025-08-24
- **SOW**: `/home/tristar/projects/chase-light2/docs/sow/20250824-CHASE-103.md`

## 実装計画

### Phase 1: デザイントークン再構造化

- [ ] 1-1. 既存の`color.semantic`トークンを`color.semantic.light`へ移動
- [ ] 1-2. ダークモード用トークンを`color.semantic.dark`に新規定義
- [ ] 1-3. プリミティブカラーでのダークモード調色検討・実装

**対象ファイル**:
- `packages/frontend/design-tokens.json`

### Phase 2: デザイントークン変換スクリプト拡張

- [ ] 2-1. 型定義の更新（テーマ別構造対応）
- [ ] 2-2. `token-parser.ts`のテーマ別解析機能実装
- [ ] 2-3. `tailwind-generator.ts`のテーマ別CSS変数生成実装
- [ ] 2-4. 変換スクリプトのテスト作成・実行

**対象ファイル**:
- `packages/frontend/scripts/design-token-converter/types.ts`
- `packages/frontend/scripts/design-token-converter/token-parser.ts`
- `packages/frontend/scripts/design-token-converter/tailwind-generator.ts`

### Phase 3: フロントエンド機能実装

- [ ] 3-1. `useTheme` Composable実装
- [ ] 3-2. `ThemeSelector`コンポーネント実装
- [ ] 3-3. アプリケーションレイアウトへの統合
- [ ] 3-4. ユーザー設定画面への組み込み（存在する場合）

**新規作成ファイル**:
- `packages/frontend/composables/useTheme.ts`
- `packages/frontend/components/ThemeSelector.vue`

**更新対象ファイル**:
- `packages/frontend/app.vue` または レイアウトファイル
- `packages/frontend/pages/settings/index.vue`（存在する場合）

### Phase 4: テスト・検証

- [ ] 4-1. 単体テストの実行
- [ ] 4-2. 主要ページでの動作確認
- [ ] 4-3. 各種ブラウザでの表示確認

## 既存コード分析結果

### 現在のデザイントークン構造

```json
{
  "color": {
    "primitive": { /* プリミティブカラー定義済み */ },
    "semantic": {
      "content": { "default": { "bg", "text" } },
      "surface": { "primary", "secondary", "outlined" },
      "interactive": { "default", "disabled", "focused", "hovered" },
      "header": { "default" },
      "sidebar": { "default" },
      "dialog": { "default", "backdrop" },
      "common": { "info", "success", "warn", "alert", "focus" }
    }
  }
}
```

### 既存変換スクリプト分析

- **types.ts**: 現在の型定義はテーマ構造に対応していない
- **token-parser.ts**: テーマ別解析機能なし、参照解決機能あり
- **tailwind-generator.ts**: @theme形式での出力対応済み、テーマ別出力機能なし

### 実装アプローチ

1. **段階的移行**: 既存構造を破壊せずに、light/dark階層を上位に配置
2. **後方互換性**: 既存参照を保持しつつ、新構造に対応
3. **CSS変数出力**: ライト用デフォルト + ダーク用`[data-theme="dark"]`セレクター

## 次の作業

次回は Phase 1 のデザイントークン再構造化から開始する予定。

## 懸念事項

- 既存コンポーネントでの`color.semantic.*`直接参照の影響範囲
- トークン参照解決の循環参照チェック機能が正常に動作するか
- CSS変数の増加によるパフォーマンスへの影響