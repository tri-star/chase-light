# CHASE-131 作業ログ (2025-09-28)

## セッションメモ
- SOW: docs/sow/20250928-CHASE-131.md
- 目的: data-sources機能をドメイン/アプリケーション/インフラ/プレゼンテーションのレイヤ構造に再編し、DI境界を整理する。
- 事前確認: プロジェクト概要、DBスキーマ設計、backendガイドライン一式を参照済み。

## 実装計画チェックリスト
- [x] 現状調査: 現在の`features/data-sources`ディレクトリ構成とサービス実装を把握する。
- [x] ドメイン整備: 既存ドメイン型を整理し、`domain/repositories`にDataSource/UserWatchのポートを再定義する。
- [x] GitHubポート定義: `application/ports/github-repository.port.ts`を追加し、取得・検証インターフェースを設計する。
- [x] ユースケース移行: 既存サービス（作成/更新/詳細/一覧/削除/ウォッチ登録）を`application/use-cases`配下のクラスへ移植し、トランザクション境界を維持する。
- [x] インフラ実装: DrizzleリポジトリとGitHub Adapter（Octokit/Stub + Factory）を`infra`配下に再配置し、新ポートへ適合させる。
- [x] 依存注入整理: `features/data-sources/index.ts`と`app.ts`でユースケース・アダプタを組み立て直す。
- [x] ルート更新: `presentation/routes`のハンドラーをユースケースベースのファクトリに置き換え、E2E制御ルートを新DIに接続する。
- [x] 影響範囲更新: detectionフィーチャー等の既存テスト・参照を新しい公開APIへ追従させる。
- [ ] 動作検証: `pnpm format`, `pnpm lint`, `pnpm test` を実行し、必要に応じて`pnpm --filter backend test`で回帰確認する。

## メモ
- GitHubスタブを新ポートに追従させ、レガシーレスポンス形式も受け付けるよう互換レイヤーを用意。
- プレゼンテーション層のテストはユースケース前提に再構成し、主要ユースケースをカバーするシナリオで再作成。
- detectionワーカー、トランザクションマネージャー等の横断テスト/スクリプトを新DIへ移行済み。
- 残タスク: フォーマット・Lint・テスト実行、および結果反映。
- レビュー対応: data-sources機能内にユーザー照会ポートを追加し、インフラ層でDrizzle実装を提供。Detectionテストは機能内ファクトリを利用するよう修正。
