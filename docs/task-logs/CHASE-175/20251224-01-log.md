# CHASE-175: アクティビティ本文の翻訳リクエスト機能 - 実装ログ

## 作業概要

- **課題ID**: CHASE-175
- **作業日**: 2025-12-24
- **担当**: Claude Code
- **SOW**: docs/sow/20251224-CHASE-175.md

## 実装計画

### Phase 1: BFF API層実装 ✓

- [x] 1-1. `packages/frontend/server/api/activities/[id]/translations/body.post.ts` を作成
- [x] 1-2. `packages/frontend/server/api/activities/[id]/translations/body.get.ts` を作成
- [x] 1-3. format, lint, コミット

### Phase 2: Domain/Repository層実装 ✓

- [x] 2-1. `packages/frontend/features/activities/domain/translation.ts` を作成
- [x] 2-2. `packages/frontend/features/activities/repositories/activity-translation-repository.ts` を作成
- [x] 2-3. format, lint, コミット

### Phase 3: Composable層実装 ✓

- [x] 3-1. `packages/frontend/features/activities/composables/use-translation-request.ts` を作成
- [x] 3-2. format, lint, コミット

### Phase 4: UIコンポーネント実装 ✓

- [x] 4-1. `packages/frontend/components/pages/activities/detail/parts/TranslationRequestBanner.vue` を作成
- [x] 4-2. `ActivityDetailContent.vue` を更新して翻訳リクエストバナーを本文上部に表示
- [x] 4-3. `use-activity-detail.ts` を更新して `refresh` 関数を返却
- [x] 4-4. `ActivityDetailPage.vue` を更新
- [x] 4-5. format, lint, コミット

### Phase 5: テスト実装 ✓

- [x] 5-1. `use-translation-request.ts` の Unit テストを作成
- [x] 5-2. `activity-detail.test.ts` に翻訳リクエスト機能のテストケースを追加
- [x] 5-3. format, lint, コミット

## 実装詳細

### Phase 1完了メモ

- BFF API層の実装が完了
- Orval生成の型を使用してZodスキーマで検証
- Backend APIへのプロキシとして機能

### Phase 2完了メモ

- フロントエンド用の型定義を作成
- Repository層でBFF APIを呼び出し、型変換
- HttpErrorを使ったエラーハンドリング

### Phase 3完了メモ

- 翻訳リクエストとポーリングロジックをcomposableとして実装
- 3秒間隔のポーリング
- onUnmountedでのクリーンアップ
- 翻訳完了時のコールバック機能

### Phase 4完了メモ

**実装ファイル:**

1. **TranslationRequestBanner.vue**
   - 翻訳未完了時のバナーコンポーネント
   - idle/requesting/polling/failed の各状態を表示
   - 翻訳リクエストボタン、再試行ボタン
   - デザイントークン準拠のスタイリング

2. **ActivityDetailContent.vue 更新**
   - 翻訳バナーの表示制御
   - `showTranslationBanner` computed
   - バナーを本文上部に配置

3. **use-activity-detail.ts 更新**
   - `refresh` 関数をreturnに追加
   - 外部から再取得可能にする

4. **ActivityDetailPage.vue 更新**
   - `use-translation-request` composableを統合
   - 翻訳完了時のrefreshコールバック設定

### Phase 5完了メモ

**実装テスト:**

1. **use-translation-request.test.ts**
   - 翻訳リクエスト送信のテスト（completed/failed/queuedケース）
   - ポーリングロジックのテスト（completed/failed検知、エラーハンドリング）
   - ポーリング停止のテスト

2. **activity-detail.test.ts**
   - 翻訳リクエストバナーの表示/非表示のテスト
   - 翻訳リクエストボタンのクリックテスト

## 実装完了

全5フェーズが完了しました。

- コミット数: 5件
- 全テスト: PASS (256 passed | 1 skipped)
- Lint/Format: PASS

## 懸念事項・未解決事項

なし

## 次のステップ

- push & PR作成
