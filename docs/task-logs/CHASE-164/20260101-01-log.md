# CHASE-164: アクティビティ一覧にフィルター機能追加 - 実装ログ

**作成日**: 2026-01-01
**SOW**: @docs/sow/20260101-CHASE-164.md

## 作業概要

アクティビティ一覧画面にキーワードフィルター機能を追加する。Backend APIには既にkeyword検索機能が実装済みのため、フロントエンド側でその機能を利用可能にする。

## 実装計画

### Phase 1: Orval再生成と型確認

- [x] 1-1. `pnpm --filter frontend generate:api` を実行してOrvalを再生成
- [x] 1-2. `GetApiActivitiesParams`にkeywordが追加されていることを確認
  - 確認完了: `generated/api/schemas/getApiActivitiesParams.ts:54` にkeywordが存在

### Phase 2: ClTextField基底コンポーネント作成

- [x] 2-1. `ClTextField.vue` の実装
  - パス: `packages/frontend/components/base/ClTextField.vue`
  - Props: modelValue, placeholder, disabled, ariaLabel, type
  - prefix/suffixスロット対応
  - 実装完了。ClSelectの実装パターンを参考に作成
- [x] 2-2. `ClTextField.stories.ts` の作成
  - パス: `packages/frontend/components/base/ClTextField.stories.ts`
  - @nuxtjs/storybook からの型インポートに修正
  - 複数のストーリー（Default, WithValue, Disabled, WithPrefix等）を作成
- [x] 2-3. `ClTextField.test.ts` のユニットテスト作成・実行
  - パス: `packages/frontend/components/base/__tests__/ClTextField.test.ts`
  - 17個のテストケース全て成功
- [x] 2-4. format, lint, コミット
  - format, lint, test全て成功

### Phase 3: BFF修正

- [x] 3-1. `activities/index.get.ts` にkeywordパラメータ対応を追加
  - パス: `packages/frontend/server/api/activities/index.get.ts`
  - クエリパラメータから`keyword`を取得し、Backend APIへ転送
  - normalizedParamsにkeywordを追加
- [x] 3-2. format, lint, コミット
  - format, lint全て成功

### Phase 4: 画面実装

- [x] 4-1. `ActivityList.vue` にkeyword props追加、API呼び出し修正、keyword変更時のリセット処理
  - パス: `packages/frontend/components/pages/activities/parts/ActivityList.vue`
  - keyword propsの追加
  - API呼び出しにkeywordパラメータ追加
  - resetList関数の実装
  - watch によるkeyword変更時のリセット処理
- [x] 4-2. `ActivityListPage.vue` にフィルターテキストフィールド追加
  - パス: `packages/frontend/components/pages/activities/ActivityListPage.vue`
  - ClTextFieldの追加（検索アイコン、クリアボタン付き）
  - 手動デバウンス処理の実装（300ms）
- [ ] 4-3. ActivityListPageのフィーチャーテスト作成・実行
  - パス: `packages/frontend/components/pages/activities/__tests__/activity-list.test.ts`
  - TODO: 次のPhaseで実装
- [x] 4-4. format, lint, コミット
  - format, lint成功（テストは次Phase）

### Phase 5: 最終確認とPR作成

- [x] 5-1. 全テスト実行
  - 274 passed | 1 skipped
  - 既存テストへの影響なし
- [ ] 5-2. 実機での動作確認
  - ローカルで `pnpm dev:frontend` を実行して動作確認推奨
- [ ] 5-3. PRの作成
  - 次のステップでPR作成

## 実装詳細メモ

### ファイル構成

#### 新規作成

1. `packages/frontend/components/base/ClTextField.vue`
2. `packages/frontend/components/base/__tests__/ClTextField.test.ts`
3. `packages/frontend/components/base/ClTextField.stories.ts`
4. `packages/frontend/components/pages/activities/__tests__/activity-list.test.ts`

#### 更新対象

1. `packages/frontend/server/api/activities/index.get.ts`
2. `packages/frontend/components/pages/activities/ActivityListPage.vue`
3. `packages/frontend/components/pages/activities/parts/ActivityList.vue`

### 技術的ポイント

- ClTextFieldはClSelectの実装パターンを参考にする
- デバウンス処理（300ms）を導入し、過剰なAPI呼び出しを防止
- keyword変更時はページとリスト状態をリセット
- 無限スクロールとの整合性を維持

## 作業記録

### 2026-01-01

#### Phase 1開始

- Orval再生成実施予定

---

## 懸念事項・未解決事項

なし（作業開始前）

---

## 参考資料

- SOW: @docs/sow/20260101-CHASE-164.md
- フォルダ構成: @packages/frontend/docs/guidelines/folder-structure.md
- コンポーネント実装ガイド: @packages/frontend/docs/guidelines/component-implementation-guide.md
- ページ実装ガイド: @packages/frontend/docs/guidelines/page-implementation-guide.md
- テスト戦略: @packages/frontend/docs/testing-strategy.md
