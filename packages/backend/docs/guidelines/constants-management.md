# 定数管理ガイドライン

## ステータス

決定済み

## コンテキスト

TypeScript + Hono + Drizzle で構成された API サーバーでは、ドメインごとに責務を閉じ込めるアーキテクチャへ移行しています。マジックナンバーや文字列を定数化し、利用レイヤーを明示することで、変更時の影響範囲を局所化しながらドキュメントと実装を同期させる必要があります。

### 現状の課題

- フィーチャー横断で同じ意味の値が重複定義されている。
- ドメイン層とプレゼンテーション層で同じ文字列リテラルを参照している。
- バリデーション値やデフォルト値がファイル内にハードコードされ、テストから参照しづらい。

## 決定

定数は以下のような規則で定義します。

- 定義場所
  - フロントエンドとも共有できるもの: packages/shared/src/constants配下のファイルに定義(必要に応じ更にフォルダを作成)
  - ドメインに関するもの: packages/backend/src/features/<feature>/domainフォルダ配下のファイルに定義
  - ドメインとは関連しないもの: packages/backend/src/features/<feature>/constantsフォルダ配下のファイルに定義
- 他フィーチャーへ共有したい値は、そのフィーチャーの `index.ts` 経由で公開 API として再エクスポートします。

## 定数化の判断基準

### 必須で定数化するもの（MUST）

- 数値リテラル（`0`, `1`, `-1` など明白な値を除く）
- 文字列リテラル（空文字列は除く）
- 配列・オブジェクト・正規表現リテラル
- エラーメッセージ・ログメッセージ
- デフォルト値やリトライ回数などの業務ルール

### 推奨事項（SHOULD）

- 外部サービスとの契約値（ヘッダー名、キュー名など）
- バリデーションの閾値や日付範囲
- テストが参照する識別子

### 例外（定数化不要）

- HTTP ステータスコード（`200`, `404` など）
- Boolean 値（`true` / `false`）
- 空文字列（`""`）や `null`, `undefined`
